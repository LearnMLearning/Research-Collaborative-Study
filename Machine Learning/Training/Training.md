#### 0. 服务器基本配置
###### 1. Intel 24 核心 48线程 128G内存 4090 4卡服务器
**服务器主机地址**: 10.109.92.121
**校内端口号**: 22 
**校外(VPN)端口号**: 10022
#### 1. 登陆服务器
**软件准备**
首先，我们需要准备以下软件，以便日后更好的操作服务器。
**终端模拟软件**是可以让用户登录到服务器上，并且在服务器上基于Linux命令直接对服务器上的文件进行 操作的软件。
**文件传输软件**是用来让用户上传本地文件到服务器上，或者把服务器上的文件下载到本地的软件。
**代码编辑器**一般会兼容以上两种常用功能(常用如Pycharm，VsCode)，但可能在终端操作或者文件传 输效率上没有前面两者那么高，但他有良好的交互界面，可以让用户就像在本地一样操作服务器上远程 的文件，比如直接在服务器上查看或者写代码。
一般来说，对于只是用来炼丹的用户，建议下**一个代码编辑器+一个文件传输软件**即可。终端模拟软件更 适合那些服务器集群操作的用户。

**远程登录软件**
Xshell，Xterm。他们都是终端仿真软件，可以**帮助用户连接到远程服务器**，而且更加广泛被专门管理服 务器的人员使用。
Xshell下载地址 https://www.xshell.com/zh/xshell/
Vscode 里面 Remode-ssh 胜任了该功能

**文件传输软件**
Xftp和Xshell是同一个公司的，可以快速安全的上传文件到远程，亦或者是下载到本地。 下载地址 https://www.xshell.com/zh/xftp/
Vscode 又直接胜任了该功能

**代码编辑器**
VsCode/Pycharm
Vscode是一款轻量级的代码编辑器，通过安装ssh插件，可以直接操作远程服务器上的文件，也可以下 载一些小文件到本地;Pycharm则是一块重量级的代码编辑器，他连接服务器后最大的特点是可以实现 本地和远程文件的同步，功能比Vscode更加全面。
一般利用这两款软件，足够应付大多数的在服务器上的代码编辑工作。

**VSCODE** 似乎胜任了所有的功能，终端模拟软件日后再说

**登陆步骤**
大部分可以远程登录的软件都是基于ssh协议来实现远程连接的。在本地主机的命令行窗口下，你可以使 用如下简单的命令连接目标主机

```
ssh username@remoteaddress -p Port
ssh chenzeye@10.109.92.119 -p 55022
```

其中 `username` 是你要登录的远程服务器的用户名，如果不写默认使用和你主机相同的用户名。 `remoteaddress` 是远程主机的 `ip` 地址，也是一台主机的唯一标识符。`-p` 是提供远程接入的端口号(不加默认端口号为 22 )，校内即 `ssh` 协议默认端口号 22，校外使用 vpn 使用校外端口号。这样，你就能够以确定的账户连接到确定的主机了。一些软件集成了这些功能，一般你只要在窗口填入相应配置就行。

既然你已经发起了连接的请求，那服务器端肯定要对你进行一个基本的身份验证。一般验证的方式有三种，为用户口令验证，用户密钥验证以及交互式响应验证。一般常用的是前两种，最后一种有兴趣可以自行查询。

对于用户口令验证，也就是输入账号对应的密码即可，但他有个缺点，就是容易被别人爆破，通过一些软件暴力把密码破解，尤其一些简单的密码。因此我们的服务器禁用了这种登录方式以保障安全性，留给我们常用的也就是用户密钥验证的方式了。

现在一般用的最广的也就是 RSA 非对称加密算法为核心的加密方式，其具体应用原理可以自行查阅。你可以在本地电脑上生成密钥对，输入如下命令

```
ssh-keygen
```

就可以在默认位置 `C:/users/username/.ssh/` 文件夹下生成你的私钥和公钥，默认文件名为 `id_rsa` 和 `id_rsa.pub` 。

在我们用本地电脑去连接服务器的应用场景下，你需要把公钥上传到服务器上，这样当你需要连接服务器时，服务器会检查你的私钥，经过一系列算法确认是否和公钥匹配，如果匹配成功则通过身份的验证。但是反过来，通过公钥来计算私钥几乎是不可能的，这也一定程度上保证了这种加密方式的安全性。

因此，你在生成密钥对后，把公钥提交给管理员，让他把你的公钥放到你服务器的账户上，这样你进行远程登录时，只要输入对用户名和主机地址，就能够成功连接了。这对于其他软件也同理，唯一不同的是有些软件需要你自己选择自己的私钥的位置进行登录。

我们假设你已经成功登录了服务器了，接下来你就需要在自己的账户下配置自己需要的环境了。

#### 2. 配置基础环境
一般来说，有些软件包比较大，从网上下载比较慢，因此管理员会提供一些公共的基础软件包在服务器 上，方便你直接下载和编译。这时候你可以直接去这个公共的文件夹找你需要的软件下载就行了。这个公共文件夹在 `/software` 下。

我们的服务器主要是用于深度学习科学计算的，因此， 和深度学习框架可能是你必不 可少的选择。对于python，我们提供了方便管理 python 版本的软件 anaconda 的包，只要直接运行安装脚本即可。当然如果你不需要服务器上提供的版本，也可以自行去官网下载。

###### 安装Anaconda
我们假设你已经登录到自己的环境里，这个时候输入如下命令即可。
```
bash /software/anaconda/Anaconda3_xxxxx.sh
#如 bash /software/anaconda/Anaconda3-2024.02-1-Linux-x86_64.sh
```
这里的 xxx 代表了一些版本信息。主要安装的时候，要把 anaconda 安装到你自己的目录下，
即 `/home/username` 。 `username` 是你登录的用户名，记得检查一下。具体安装细节，请自行查阅。

###### 安装 PyTorch
首先要清楚，我们服务器的cuda版本为12.0，因此在安装pytorch时，不要安装比cuda版本更加高的版 本了。这体现在官网的文件中，cu118表示cuda版本为11.8.同时也要注意好python的版本，比如cp39 就是python3.9版本。

pytorch官方网址为 https://pytorch.org/, 如果不想用服务器上已经提供的，也可以自行去官网下载。

但是如果你直接在命令行输入 pip install torch=xxx... 这样，服务器就会先去下载torch的预编译文件， 一般来说得用个5分钟左右下载，省力的方式自然是直接用提供的预编译文件了，也就是whl文件，是用 于python的一种分发包格式，和源代码包比起来，他提供了更加快的安装速度和更好的跨平台性。如果 你想下载其他的版本，又想用 whl 来安装，可以去这个网址https://download.pytorch.org/whl/torch_st able.html。 找到你想要的 whl 文件后上传到服务器进行安装。

进入你 python 的虚拟环境后，直接命令行输入下面命令即可。其中xx代表你 pytorch 适配的 python 版本，yy 代表你选择哪个版本的 pytorch，在这个文件夹下，一般有 torch 和 torchvision 这两种包。对于计 算机视觉任务来说，这两个包足够了。

```
pip install /software/pytorch/cpxx_thyy/zzz
#如 pip install /software/pytorch/cp39_th21/torch-2.1.0+cu118-cp39-cp39- linux_x86_64.whl
```

此外，除了torch，我们一般还需要用到 `torchvision` 这个包，去对应的文件夹 install 下就行，同一个 文件夹下的 `torch` 和 `torchvision` 的 `whl` 文件版本一定是适配的，如果你要自己去官网下载，请注意 这个问题。除了这两个包比较大以外，其他你可能需要的包都可以通过服务器直接在网络上下载。

完成了这两步，你就可以在服务器上玩耍了!祝你玩得愉快!

#### 3. 服务器常用命令
**查看服务器工作情况**
```
watch -n 1 nvidia-smi
```
![[Pasted image 20240627153001.png]]

**查看每个进程占用资源**
最原始
```
top
```


```
htop
```
![[Pasted image 20240627153421.png]]
目前干什么不知道 以后再研究

**管理终端**
```
screen
```

```
screen -h
```

![[Pasted image 20240627153856.png]]

**screen**
创建名为 123 的隔离终端
```
screen -R 123
```

```
screen -R train_0
```

```
screen -R train_3
```

在里面 `exit` 可以彻底关掉

在里面要回到主终端 ctrl+A, D detach

#### 4. 模型训练 (以DeepCrack为例)
###### model
模型结构定义
![[Pasted image 20240627160408.png|500]]
`train.py` 训练主代码
`trainer.py` 函数
![[Pasted image 20240627160655.png|500]]
`config.py` 超参 索引
![[Pasted image 20240627161400.png|500]]
`infer.py` 推断
![[Pasted image 20240627162256.png|500]]
1440 * 1440 实际，最好裁成这样

改服务器对应关系
```
screen -R train_3
```

```
export CUDA_VISIBLE_DEVICES=3
```

###### 开始训练
```
python train.py
```



[[Dataset]]
